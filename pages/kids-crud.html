<head>

</head>

<div class="profiles" id="profile-grid">
    <div class="profile" id="1">
      <img src="../utils/images/profile1.png" alt="Profile 1">
      <h3 class="profile-name">John Doe</h3>
    </div>
    <div class="profile" id="2">
      <img src="../utils/images/profile2.png" alt="Profile 2">
      <h3 class="profile-name">Jane Doe</h3>
    </div>
</div>

<div class="popup" id="popup">
    <div class="popup-content">
      <h2>Register New Kid</h2>
        <form>
            <!-- <label for="name">Name</label> -->
            <input class="input-form" type="text" id="pin" maxlength="6" name="name" placeholder="name">

            <!-- <label for="pin">Pin</label> -->
            <input class="input-form password" type="text" id="pin" maxlength="6" name="pin" placeholder="pin">

            <!-- <label for="age">Age</label> -->
            <input class="input-form" type="number" id="age" max="17" name="pin" placeholder="age">

            <!-- <label for="image">Avatar</label> -->
            <div class="profile-image-container">
                <img class="profile-image" src="" alt="Profile Image">
                <div class="image-navigation">
                  <button onclick="prevImage()">◀</button>
                  <button onclick="nextImage()">▶</button>
                </div>
            </div>

            <input id="submit-pin" class="main-button" type="submit" value="Confirm">
            <a id="close" class="main-button">Go Back</a>
        </form>
    </div>
  </div>

<script>
    const profiles = document.querySelectorAll('.profile');
    const popup = document.getElementById('popup');
    const closeBtn = document.getElementById('close');

    closeBtn.addEventListener('click', () => {
    popup.style.display = 'none';
    });

    // Function to fetch profile data from JSON file
    async function fetchProfilesData() {

        const userID = 1; //PLACEHOLDER
        const baseUrl = `http://localhost:3000/api/user/kids/${userID}`

        try {
            const response = await fetch(baseUrl, {
                method: 'GET'
            });

            const profilesData = await response.json();
            return profileData;
        } catch (error) {
            console.error('Error fetching profile data:', error);
            return [];
        }
    }

    // Function to generate profile cards
    function generateProfileCards(profiles) {
    const profileGrid = document.getElementById('profile-grid');
    profileGrid.innerHTML = ''; // Clear existing content

    profiles.forEach(profile => {
        const profileCard = document.createElement('div');
        profileCard.classList.add('profile');
        profileCard.innerHTML = `
            <div class="profile" id="1">
                <img src="../utils/images/${profile.avatar}.png" alt="Profile Avatar">
                <div class="under-image">
                    <h3 class="profile-name">${profile.name}</h3>
                    <div class="profile-actions">
                        <a img="../utils/images/edit-icon.png" onclick="editProfile(${profile.id})"></a>
                        <a img="../utils/images/delete-icon.png" onclick="deleteProfile(${profile.id})"></a>
                    </div>
                </div>
            </div>
        `;

        profileGrid.appendChild(profileCard);
    });

    // Add the 'Add Profile' card
    const addProfileCard = document.createElement('div');
    addProfileCard.classList.add('profile-card');
    addProfileCard.innerHTML = `
        <img src="placeholder.png" alt="Add Profile" onclick="addProfile()">
        <a class="add-button" onclick="addProfile()">Add Profile</a>
    `;
    profileGrid.appendChild(addProfileCard);
    }

    // Function to edit profile
    function editProfile(profileId) {
    alert("Edit profile with ID: " + profileId);
    popup.style.display = 'block';

    location.reload();
    }

    // Function to delete profile
    function deleteProfile(profileId) {
    alert("Delete profile with ID: " + profileId);
    location.reload();
    }

    // Function to add profile
    function addProfile() {
    alert("Add new profile");
    popup.style.display = 'block';


    location.reload();
    }

    // This area is for changing the profile picture
    let currentImageIndex = 0;
    const images = ['profile1.png', 'profile2.png', 'profile3.png', 'profile4.png', 'profile5.png', 'profile6.png', 'profile7.png', 'profile8.png', 'profile9.png'];

    // Function to update the profile image source
    function updateProfileImage() {
    const profileImage = document.querySelector('.profile-image');
    profileImage.src = `utils/images/${images[currentImageIndex]}`;
    }

    const prevImage = () => {
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        updateProfileImage();
    }

    const nextImage = () => {
        currentImageIndex = (currentImageIndex + 1) % images.length;
        updateProfileImage();
    }

    // Function to handle form submission
    const handleSubmit = () => {
        const selectedImageId = currentImageIndex + 1;
        alert(`Selected Image ID: ${selectedImageId}`);
        
    }

    // Updating when the page loads
    window.onload = async () => {
    const profilesData = await fetchProfilesData();
    generateProfileCards(profilesData);
    };

</script>