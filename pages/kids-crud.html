<html>
    <head>
        <link rel="stylesheet" type="text/css" href="../css/all.css">
        <link rel="stylesheet" type="text/css" href="../css/cruds.css">
    </head>
    <body>
        <div class="profiles" id="profile-grid">
            <div class="profile" id="1">
            <img src="../utils/images/profile1.png" alt="Profile 1">
            <h3 class="profile-name">John Doe</h3>
            </div>
            <div class="profile" id="2">
            <img src="../utils/images/profile2.png" alt="Profile 2">
            <h3 class="profile-name">Jane Doe</h3>
            </div>
        </div>

        <div class="popup" id="popup">
            <form>
                <!-- <label for="pin">Pin</label> -->
                <input class="input-form password" type="text" id="pin" maxlength="6" name="pin" placeholder="pin">

                <!-- <label for="age">Age</label> -->
                <input class="input-form" type="number" id="age" max="17" name="pin" placeholder="age">

                <!-- <label for="image">Avatar</label> -->
                <div class="profile-image-container">
                    <img class="profile-image" src="" alt="Profile Image">
                    <div class="image-navigation">
                    <button onclick="prevImage()">◀</button>
                    <button onclick="nextImage()">▶</button>
                    </div>
                </div>

                <input id="submit-pin" class="main-button" type="submit" value="Confirm">
                <a id="close" class="main-button">Go Back</a>
            </form>
        </div>
    </body>
</html>


<script>
    const userId = "65fa852db94c1e6a89608399";
    const apiUrl = "http://localhost:3000/tubekids/kids";
    const profiles = document.querySelectorAll('.profile');
    const popup = document.getElementById('popup');
    const closeBtn = document.getElementById('close');

    closeBtn.addEventListener('click', () => {
    popup.style.display = 'none';
    });

    // Generate each card
    const generateProfileCards = async () => {
        const profileGrid = document.getElementById('profile-grid');
        profileGrid.innerHTML = ''; // Clear existing content

        const res = await fetch(
            apiUrl + "/user/" + userId, 
            {
                method: 'GET',
            }
        )
        const profiles = await res.json();

        profiles.forEach(profile => {
            const profileCard = document.createElement('div');
            profileCard.classList.add('profile');
            profileCard.innerHTML = `
                <div class="profile" id="${profile._id}">
                    <img src="../utils/images/profile${profile.avatar}.png" alt="Profile Avatar">
                    <div class="under-image">
                        <h3 class="profile-name">${profile.name}</h3>
                        <div class="profile-actions">
                            <a onclick="editProfile('${profile._id}')"><img class="icon modify edit" src="../utils/images/modify-icon.png"/></a>
                            <a onclick="deleteProfile('${profile._id}')"><img class="icon modify delete" src="../utils/images/delete-icon.png"/></a>
                        </div>
                    </div>
                </div>
            `;
        

        profileGrid.appendChild(profileCard);
    });
    

        // Add the 'Add Profile' card
        const addProfileCard = document.createElement('div');
        addProfileCard.classList.add('profile');
        addProfileCard.innerHTML = `
                <div class="profile" >
                    <img src="../utils/images/placeholder.png" onclick="addProfile()" alt="Add Profile">
                    <div class="under-image">
                        <div class="profile-actions">
                            <a class="add-button" onclick="addProfile()"><h3>Add Profile</h3></a>
                        </div>
                    </div>
                </div>
            `;
        profileGrid.appendChild(addProfileCard);
    }

    // Edits a profile
    const editProfile = async (profileId) => {
        alert("Edit profile with ID: " + profileId);
        popup.style.display = 'block';
    }

    // Deletes a profile
    const deleteProfile = (profileId) => {
        alert("Delete profile with ID: " + profileId);
        
    }

    // Add a profile
    const addProfile =() => {
        alert("Add new profile");
        popup.style.display = 'block';
    }

    // This area is for changing the profile picture
    let currentImageIndex = 0;
    const images = ['profile1.png', 'profile2.png', 'profile3.png', 'profile4.png', 'profile5.png', 'profile6.png', 'profile7.png', 'profile8.png', 'profile9.png'];

    // Function to update the profile image source
    const updateProfileImage = () => {
        const profileImage = document.querySelector('.profile-image');
        profileImage.src = `../utils/images/${images[currentImageIndex]}`;
    }

    const prevImage = () => {
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        updateProfileImage();
    }

    const nextImage = () => {
        currentImageIndex = (currentImageIndex + 1) % images.length;
        updateProfileImage();
    }

    // // Function to handle form submission
    // const handleSubmit = () => {
    //     const selectedImageId = currentImageIndex + 1;
    //     alert(`Selected Image ID: ${selectedImageId}`);
        
    // }

    // Updating when the page loads
    window.onload = async () => {
        generateProfileCards();
    };

</script>